{% extends 'employees/base.html' %}

{% block title %}Детали {{ employee.name }}{% endblock %}

{% block content %}
<h1>{{ employee.name }}</h1>
<p>Баланс: <span class="balance">{{ employee.get_balance }} ₽</span></p>
<h2>История транзакций</h2>

<div style="margin-bottom: 15px;">
    <label for="per_page_select" style="display: inline; margin-right: 10px;">Показать:</label>
    <select id="per_page_select" onchange="changePerPage(this.value)" style="width: auto; display: inline-block;">
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
        <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
    </select>
    <span style="margin-left: 10px;">записей</span>
</div>

<div class="table-container">
    <table>
        <tr>
            <th>Дата</th>
            <th>Сумма</th>
            <th>Описание</th>
        </tr>
        {% for transaction in page_obj %}
        <tr>
            <td>{{ transaction.date_time }}</td>
            <td>{{ transaction.amount }} ₽</td>
            <td>{{ transaction.description }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" style="text-align: center;">Нет транзакций</td>
        </tr>
        {% endfor %}
    </table>
</div>

<div class="pagination">
    <span class="page-info">
        Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }} 
        (всего записей: {{ page_obj.paginator.count }})
    </span>
    
    <div class="pagination-controls">
        {% if page_obj.has_previous %}
            <a href="?page=1&per_page={{ per_page }}" class="page-link">« Первая</a>
            <a href="?page={{ page_obj.previous_page_number }}&per_page={{ per_page }}" class="page-link">‹ Назад</a>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <span class="page-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}&per_page={{ per_page }}" class="page-link">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&per_page={{ per_page }}" class="page-link">Вперед ›</a>
            <a href="?page={{ page_obj.paginator.num_pages }}&per_page={{ per_page }}" class="page-link">Последняя »</a>
        {% endif %}
    </div>
</div>

<a href="{% url 'employee_list' %}">Вернуться к списку</a>

<script>
function changePerPage(value) {
    window.location.href = '?page=1&per_page=' + value;
}
</script>
{% endblock %}